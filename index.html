<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Color Clash</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700;800&display=swap" rel="stylesheet">
  <style>
    body { font-family: 'Inter', sans-serif; }
    .spinner {
      border-top-color: #3b82f6;
      border-right-color: transparent;
      border-bottom-color: transparent;
      border-left-color: transparent;
    }
  </style>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database.js"></script>
</head>
<body class="bg-[#f0f4f8] flex items-center justify-center min-h-screen p-4">

  <!-- Main Game Container -->
  <main class="bg-white rounded-3xl shadow-2xl p-8 flex flex-col items-center max-w-lg w-full">

    <!-- Header -->
    <header class="text-center mb-6">
      <h1 class="text-5xl md:text-6xl font-extrabold text-gray-800">Color Clash</h1>
    </header>

    <!-- Status -->
    <div class="w-full text-center text-lg font-medium text-gray-600 mb-6">
      <div class="flex justify-between items-center mb-2">
        <span>Your ID:</span>
        <span id="your-id" class="font-bold text-gray-800"></span>
      </div>
      <div class="flex justify-between items-center mb-2">
        <span>Opponent(s):</span>
        <span id="opponent-id" class="font-bold text-gray-800">waiting...</span>
      </div>
      <div id="loading-spinner" class="mt-4 hidden">
        <div class="spinner animate-spin h-8 w-8 rounded-full border-4 border-t-blue-500"></div>
      </div>
    </div>

    <!-- Game Board -->
    <div id="board" class="grid grid-cols-3 gap-2 w-full aspect-square bg-gray-100 rounded-lg p-2 mb-6 shadow-inner">
      <div class="board-square bg-white rounded-md cursor-pointer"></div>
      <div class="board-square bg-white rounded-md cursor-pointer"></div>
      <div class="board-square bg-white rounded-md cursor-pointer"></div>
      <div class="board-square bg-white rounded-md cursor-pointer"></div>
      <div class="board-square bg-white rounded-md cursor-pointer"></div>
      <div class="board-square bg-white rounded-md cursor-pointer"></div>
      <div class="board-square bg-white rounded-md cursor-pointer"></div>
      <div class="board-square bg-white rounded-md cursor-pointer"></div>
      <div class="board-square bg-white rounded-md cursor-pointer"></div>
    </div>

    <!-- Buttons -->
    <div class="w-full grid gap-4 grid-cols-1 md:grid-cols-3">
      <button id="find-game-btn" class="w-full py-3 rounded-lg font-semibold text-white bg-blue-500 hover:bg-blue-600">
        Find a Game
      </button>
      <button id="create-room-btn" class="w-full py-3 rounded-lg font-semibold text-white bg-blue-500 hover:bg-blue-600">
        Create Room
      </button>
      <button id="join-room-btn" class="w-full py-3 rounded-lg font-semibold text-white bg-blue-500 hover:bg-blue-600">
        Join Room
      </button>
    </div>

  </main>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
    import { getDatabase, ref, set, push, onValue } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-database.js";

    // Firebase Config (replace with your DB URL in console)
    const firebaseConfig = {
      apiKey: "AIzaSyAAdhMaGfsTQ2Er9fx3dAGF5vYY0Kq54lQ",
      authDomain: "colorgame-d6c1e.firebaseapp.com",
      databaseURL: "https://colorgame-d6c1e-default-rtdb.firebaseio.com",
      projectId: "colorgame-d6c1e",
      storageBucket: "colorgame-d6c1e.firebasestorage.app",
      messagingSenderId: "898360521882",
      appId: "1:898360521882:web:f23372e10787323435db23",
      measurementId: "G-75VYMC3GPV"
    };

    // Init
    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    // Player ID
    let yourPlayerId = "player_" + Math.floor(Math.random() * 10000);
    document.getElementById("your-id").textContent = yourPlayerId;
    let currentRoomId = null;

    // Firebase Functions
    function createRoom(playerId) {
      const roomRef = ref(db, "rooms");
      const newRoomRef = push(roomRef);
      set(newRoomRef, {
        players: { [playerId]: true },
        createdAt: Date.now()
      });
      currentRoomId = newRoomRef.key;
      listenRoom(currentRoomId);
      return currentRoomId;
    }

    function joinRoom(roomId, playerId) {
      const roomPlayersRef = ref(db, "rooms/" + roomId + "/players/" + playerId);
      set(roomPlayersRef, true);
      listenRoom(roomId);
    }

    function listenRoom(roomId) {
      const roomRef = ref(db, "rooms/" + roomId + "/players");
      onValue(roomRef, (snapshot) => {
        const players = snapshot.val();
        if (players) {
          const names = Object.keys(players).filter(p => p !== yourPlayerId);
          document.getElementById("opponent-id").textContent = names.join(", ") || "waiting...";
        }
      });
    }

    // Button Actions
    document.getElementById("create-room-btn").addEventListener("click", () => {
      createRoom(yourPlayerId);
    });

    document.getElementById("join-room-btn").addEventListener("click", () => {
      if (currentRoomId) {
        joinRoom(currentRoomId, yourPlayerId);
      } else {
        alert("No active room. Ask a friend for the room ID.");
      }
    });

    document.getElementById("find-game-btn").addEventListener("click", () => {
      alert("Matchmaking coming soon...");
    });

    // Board Sync (basic demo)
    const boardSquares = document.querySelectorAll(".board-square");
    boardSquares.forEach((square, idx) => {
      square.addEventListener("click", () => {
        if (!currentRoomId) {
          alert("Join or create a room first!");
          return;
        }
        const squareRef = ref(db, `rooms/${currentRoomId}/board/${idx}`);
        set(squareRef, yourPlayerId);
      });
    });

    // Listen for board changes
    function listenBoard(roomId) {
      const boardRef = ref(db, "rooms/" + roomId + "/board");
      onValue(boardRef, (snapshot) => {
        const board = snapshot.val() || {};
        boardSquares.forEach((sq, idx) => {
          if (board[idx]) {
            sq.style.backgroundColor = board[idx] === yourPlayerId ? "#3b82f6" : "#f87171";
          }
        });
      });
    }
    // Call when joined
    function listenRoomAndBoard(roomId) {
      listenRoom(roomId);
      listenBoard(roomId);
    }
  </script>

</body>
</html>